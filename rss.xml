<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Iury's Thoughtbox Blog]]></title><description><![CDATA[An engineer thinking out loud]]></description><link>https://iurysza.github.com/thoughtbox</link><generator>GatsbyJS</generator><lastBuildDate>Wed, 17 Aug 2022 18:15:47 GMT</lastBuildDate><item><title><![CDATA[From macro to micro]]></title><description><![CDATA[There’s this interesting idiom in English: to miss the forest for the trees. From the Merriam-Webster dictionary:
to not understand or…]]></description><link>https://iurysza.github.com/thoughtbox/problem-solving/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/problem-solving/</guid><pubDate>Wed, 13 Jul 2022 15:30:37 GMT</pubDate><content:encoded>&lt;p&gt;There’s this interesting idiom in English:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;to miss the forest for the trees.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;From the &lt;a href=&quot;https://www.merriam-webster.com/dictionary/miss%20the%20forest%20for%20the%20trees&quot;&gt;Merriam-Webster dictionary&lt;/a&gt;:
&lt;em&gt;to not understand or appreciate a larger situation, problem, etc., because one is considering only a few parts of it.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I think this idea translates very well to problem-solving. Sometimes we fail to see the big picture because you’re trapped
on the small details. Let’s consider for example the case of algorithm coding problems.&lt;/p&gt;
&lt;h1&gt;Algorithm coding problems&lt;/h1&gt;
&lt;p&gt;Whether you agree with solving these as part of a hiring process is beyond the point of this article. But if
you visit a website like &lt;a href=&quot;https://leetcode.com/&quot;&gt;Leet Code&lt;/a&gt; or &lt;a href=&quot;https://www.hackerrank.com/&quot;&gt;HackerRank&lt;/a&gt; you can easily
spot that there are multiple categories of problems.&lt;/p&gt;
&lt;p&gt;There are problems with trees, graphs, sliding windows, etc. Each of these categories represent a sets of
problems which you can solve by applying a certain algorithm.&lt;/p&gt;
&lt;p&gt;These algorithms are, at the highest level, the main tool you’re going to use to solve a problem.
It is only natural that first you need to have these tools on your tool belt to be able to use them.&lt;/p&gt;
&lt;h1&gt;Your Tool belt&lt;/h1&gt;
&lt;p&gt;Knowing when to use an algorithm and knowing how to implement it should be the first step.
That seems kinda obvious, right?
But, the point is that if you’re solving a sliding window problem, creating a sliding window, needs to be trivial for you.&lt;/p&gt;
&lt;p&gt;It can be really frustrating to forget about a certain check, or getting some kind of out of bounds exception because
you can’t remember what a sliding window looks like.
When you’re solving a problem, a sliding window has to be just a tool. When you decide to use it, it’s gotta be ready to go.&lt;/p&gt;
&lt;h1&gt;Knowing your tool&lt;/h1&gt;
&lt;p&gt;The other thing is understanding how to use that tool. Think of it as just any other tool… like a drill.
It’s got some buttons and some switches that can alter its behavior. You can also use different bits depending on surface.&lt;/p&gt;
&lt;p&gt;Having a drill by itself is not enough. You have to know what can be changed or configured on it for
different scenarios.&lt;/p&gt;
&lt;p/&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 833px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/86becb53ec7bd43330dc63f259e535be/ad42d/drill.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAcDBQn/xAAVAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAAB3CWTrnc7EAU//8QAHBAAAgICAwAAAAAAAAAAAAAAAQUCBgMEERMU/9oACAEBAAEFArE6x19PXrY4bPInkMF+qz0/Ji74gRH/xAAbEQEBAQACAwAAAAAAAAAAAAABAhIAESEiQv/aAAgBAwEBPwGpqmEtnNlIA7M1LFd/PtsTp3MecjNc/8QAGxEBAQEAAgMAAAAAAAAAAAAAAQIRABIhIkH/2gAIAQIBAT8BmpChgpqcFX0dlKnHN8MuidafuJz/xAAiEAACAgEEAgMBAAAAAAAAAAABAgMEBQAREiETQRQxQmH/2gAIAQEABj8CyOYsQzzQY6rPclSqoeUxwLyKry6Dt0F6bv8AJUMRexOTwMuFiXFVcviJ7ErCxdrvYatYW7UdIpKU0EjQK0LfbtLsWVUdh2CffE7jf3q3QuI0lW7A9axGJZI+UUg4uA0bKyEj9IVb+6+SyqbHhaAShQsnhaQStHy+yvkAYA9A7n3rYa//xAAbEAEBAAMBAQEAAAAAAAAAAAABEQAhMVFhQf/aAAgBAQABPyFGEYRoGwsS3cABzZlXByraBlzfMQHwZo+X3czc2XVed4538yaEgnSsNpVcJVgnh6yv1gV+5//aAAwDAQACAAMAAAAQpA//xAAXEQEBAQEAAAAAAAAAAAAAAAABERAh/9oACAEDAQE/EDhpoXN8tQiaqwv/xAAXEQEBAQEAAAAAAAAAAAAAAAABERAh/9oACAECAQE/EE9AKXjUKCGIQz//xAAXEAEBAQEAAAAAAAAAAAAAAAABEQAh/9oACAEBAAE/EAfPCMkywW8YL1Pq4mrJbuz2WmAUCAlYVCKFO5ffFNxNvigRBBCNiHZYld1Hk1a4EKvRLKhgBRYArN//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/86becb53ec7bd43330dc63f259e535be/577d7/drill.webp 300w,
/static/86becb53ec7bd43330dc63f259e535be/93ccb/drill.webp 600w,
/static/86becb53ec7bd43330dc63f259e535be/7c7b3/drill.webp 833w&quot;
              sizes=&quot;(max-width: 833px) 100vw, 833px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/86becb53ec7bd43330dc63f259e535be/622f1/drill.jpg 300w,
/static/86becb53ec7bd43330dc63f259e535be/58041/drill.jpg 600w,
/static/86becb53ec7bd43330dc63f259e535be/ad42d/drill.jpg 833w&quot;
            sizes=&quot;(max-width: 833px) 100vw, 833px&quot;
            type=&quot;image/jpeg&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/86becb53ec7bd43330dc63f259e535be/ad42d/drill.jpg&quot;
            alt=&quot;drill&quot;
            title=&quot;drill&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div style=&quot;text-align: center;&quot;&gt; a drill &lt;/div&gt;
&lt;p/&gt;
&lt;p&gt;For example, a sliding window can have a dynamic, or static width.
Or maybe you need to keep track of different things while you’re moving across the dataset. Knowing how to work with
the tool is key.&lt;/p&gt;
&lt;h1&gt;Sharpening your tool&lt;/h1&gt;
&lt;p&gt;The next thing is the language and its data structures and idioms. You have to be comfortable with the language
that you’re going to work with. Compilation errors shouldn’t catch off guard you. You have to make sure that you
know how to use its data types. Working with Arrays, and maps should really not be a problem.&lt;/p&gt;
&lt;h1&gt;Planning and Zooming&lt;/h1&gt;
&lt;p&gt;If you have these out of the way, then you can really focus on what the problem is about.
In my experience, ideally you should to have a plan before you start coding. Drawing, sketching, writing, etc
are all useful at this point.
This way you can piece together each part of the idea and gradually zoom in, from the bigger picture, to the small details
of the implementation.&lt;/p&gt;
&lt;p&gt;Then, you can validate your assumptions at each step of the way:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Is my sliding window iterating over the dataset correctly?&lt;/li&gt;
&lt;li&gt;Is this validation correct?&lt;/li&gt;
&lt;li&gt;Is the content of that data structure correct?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;But, if you start having issues with your sliding window implementation because you forgot how to keep track of the
pointers, or if compilation errors keep popping up, or you can’t add new items to your hash-map,
then this will take up your energy, and you won’t be able to be to focus on the actual problem-solving.&lt;/p&gt;
&lt;p&gt;Since you can only keep a certain amount of subjects in your working memory, it’s important to use it efficiently.
Avoiding constant changes in this zoom level helps to manage the amount of information you’re going to have to work with.&lt;/p&gt;
&lt;h1&gt;Wrap up - Keeping the forest in sight&lt;/h1&gt;
&lt;p&gt;Keeping context switching to a minimum is a key part of problem-solving for me. I usually trip over myself
when I’m trying to think through something only to find out that some basic assumptions were wrong. Or if I keep getting
weird compilation errors, or if my hash-map is not working as I thought.
When you start to jump around fixing different parts of the implementation, at different “zoom levels”,
you lose sight of the forest. For that reason, &lt;em&gt;when studying&lt;/em&gt;, I think it’s important to check each of these stages
before jumping into a problem.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Nesting React Components in Native UI]]></title><description><![CDATA[React Native has support for creating Native UI components which are implemented using the native ui frameworks, and
exposed as react-native…]]></description><link>https://iurysza.github.com/thoughtbox/react-native-nested-views/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/react-native-nested-views/</guid><pubDate>Tue, 05 Jul 2022 18:46:37 GMT</pubDate><content:encoded>&lt;p&gt;React Native has support for creating Native UI components which are implemented using the native ui frameworks, and
exposed as react-native components. This is the most common use case, but there’s also a not so common one, which
allows you to nest React Native components inside the native UI.&lt;/p&gt;
&lt;p&gt;Now, let’s skip the whole discussion about whether you should do that or not.
Since there’s not a lot of info about this on the web, the main point of this article is to give you a brief overview
of what nesting react components looks like in practice and how to implement that on both platforms.&lt;/p&gt;
&lt;h2&gt;Native UI Components in React-native&lt;/h2&gt;
&lt;p&gt;I’m breaking down this feature in two main use cases:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Basic Native UI component&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;You have a native ui component which can be shown inside a React Native app, side-by-side a react component.&lt;/p&gt;
&lt;p&gt;This one is well covered, you can follow the &lt;a href=&quot;https://reactnative.dev/docs/native-components-ios&quot;&gt;official docs&lt;/a&gt; to
implement it.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nesting React Native components in Native UI&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In addition to the basic use case, this &lt;code class=&quot;language-text&quot;&gt;native-ui&lt;/code&gt; also supports having react components being laid out inside it.&lt;/p&gt;
&lt;p&gt;Let’s take a second to visualize what we want to build:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8b5afdab42ac619a5a3751a9117d6ff1/d6a86/rn-article.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACKElEQVQ4y3WTbW/SUBiG++P9YIw/QPfBaExMNCRqnEvYFqM4hb3AtgplWymj0Ja+nb5AYRvSXqZlY2xuH66cp+0597lP7+dIwQjENX6cFeR1OF7gxSnBKCMY59zOEyvrVpFMcYUdznGidDnRjTIGXorupuyrSTGaAgw/XW76GFKlc47qxGjumDhZuNLdOaWjE17Xa7yp13jb2OXDcYNNxSQ/Ue60GB9Aqp5EdKwrVPMCpT8pdtGdv7xqVHiplHnRLLPW2mStuUHpTxs/BMubMvAnGGJaYIoLrOCSgZggmUGGKeYMgxQryIgnoHspZUWm0Ttg//yIve4Rv7Q663WFjh7T7QdoTohqC/p+QscJUEybrhshGWaEF85wxRVDZ0JX9zg8tXn34welqoysnTOLPHxbpXam48YQJrehBdcBRtfP0m71kK2Nbcrrm8iySrutI2uC0l6Vj/u7/FQqtPTvVM++UDnt4UYg4sfDkYIELHfK0LssfnZyCao946DTZBarCKHjen2E36emWji54Ci702J32iZ/WaQ2XvRXOALNmVE9O8XzOli2hWUb6KbGzsmgOPKN4IN9eN9yLmz4c9Z2LJ6UezzbHvD8m8nTLYNPh6L47t1bs3opJHHvptwIbrUSPh9PKO35vP895GtzSk27WIaxyqrb/wSXwqOMKMkDmKMbIT0jpKUnKIMp7cGUVn+C3EtQ+tPHHd4Vva1z126Y4qxg5wSLejXlf+kxyR8plLSwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/8b5afdab42ac619a5a3751a9117d6ff1/577d7/rn-article.webp 300w,
/static/8b5afdab42ac619a5a3751a9117d6ff1/93ccb/rn-article.webp 600w,
/static/8b5afdab42ac619a5a3751a9117d6ff1/1aa16/rn-article.webp 1200w,
/static/8b5afdab42ac619a5a3751a9117d6ff1/daa23/rn-article.webp 1800w,
/static/8b5afdab42ac619a5a3751a9117d6ff1/54426/rn-article.webp 1884w&quot;
              sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/8b5afdab42ac619a5a3751a9117d6ff1/37b9b/rn-article.png 300w,
/static/8b5afdab42ac619a5a3751a9117d6ff1/ab3c7/rn-article.png 600w,
/static/8b5afdab42ac619a5a3751a9117d6ff1/5c837/rn-article.png 1200w,
/static/8b5afdab42ac619a5a3751a9117d6ff1/2f4db/rn-article.png 1800w,
/static/8b5afdab42ac619a5a3751a9117d6ff1/d6a86/rn-article.png 1884w&quot;
            sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/8b5afdab42ac619a5a3751a9117d6ff1/5c837/rn-article.png&quot;
            alt=&quot;rn article&quot;
            title=&quot;rn article&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;So, what are we looking at?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We have a React Native App which has a &lt;code class=&quot;language-text&quot;&gt;Native UI Component&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;This &lt;code class=&quot;language-text&quot;&gt;Native UI Component&lt;/code&gt; has a native view, which acts as &lt;code class=&quot;language-text&quot;&gt;slot&lt;/code&gt; in its view hierarchy where we place the &lt;code class=&quot;language-text&quot;&gt;nested react-native component&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Finally, we have a simple &lt;code class=&quot;language-text&quot;&gt;React Native Component&lt;/code&gt; as a sibling of the &lt;code class=&quot;language-text&quot;&gt;Native UI Component&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;From the react-native side, this could look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; requireNativeComponent &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-native&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; YourNativeComponent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;requireNativeComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;YourNativeComponent&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;App&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;JSX&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;Element&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;View&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;YourNativeComponent&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;View&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;nativeID&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;aWildNativeID&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
          &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Button&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;Nested React native Button&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;View&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;YourNativeComponent&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Button&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;React native Button&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;View&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We’ll revisit this later, but for now, let’s take a look at the native code.&lt;/p&gt;
&lt;h2&gt;Native Changes&lt;/h2&gt;
&lt;p&gt;Let’s quickly go over the basic building blocks of native-ui integration with react.&lt;/p&gt;
&lt;p&gt;On &lt;strong&gt;android&lt;/strong&gt; we have the &lt;code class=&quot;language-text&quot;&gt;ViewGroupManager&lt;/code&gt; class, which you need to extend from to create a native ui component.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; YourNativeComponentManager &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ViewGroupManager&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YourComponentView&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createViewInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ThemedReactContext&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; FrameLayout &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;YourComponentView&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;addView&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;parent&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; YourComponentView&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; child&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; View&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Int&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  	  &lt;span class=&quot;token function&quot;&gt;TODO&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Add child to view hierarchy&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;YourNativeComponent&quot;&lt;/span&gt;&lt;/span&gt;

	&lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On &lt;strong&gt;iOS&lt;/strong&gt; that looks a bit different:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;swift&quot;&gt;&lt;pre class=&quot;language-swift&quot;&gt;&lt;code class=&quot;language-swift&quot;&gt;&lt;span class=&quot;token attribute atrule&quot;&gt;@objc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;YourNativeComponentManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;YourNativeComponentManager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RCTViewManager&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UIView&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;YourNativeComponentView&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;YourNativeComponentView&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UIView&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;insertReactSubview&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token omit keyword&quot;&gt;_&lt;/span&gt; subview&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UIView&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; at atIndex&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// TODO: add subview to view hierarchy&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When the react-native side starts nesting components, as we showed before, you’ll start receiving calls to the
&lt;code class=&quot;language-text&quot;&gt;addView&lt;/code&gt; method on &lt;strong&gt;android&lt;/strong&gt; and to the &lt;code class=&quot;language-text&quot;&gt;insertReactSubview&lt;/code&gt; on &lt;strong&gt;iOS&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;These methods will allow you to actually lay out the views on your component’s view hierarchy.&lt;/p&gt;
&lt;h2&gt;Advanced Layout Strategy&lt;/h2&gt;
&lt;p&gt;If you plan to nest multiple kinds of components in different places of your view, you will need to change things a bit.&lt;/p&gt;
&lt;p&gt;Imagine you have &lt;code class=&quot;language-text&quot;&gt;react-component A&lt;/code&gt; and a &lt;code class=&quot;language-text&quot;&gt;react-component-B&lt;/code&gt; and they need to be placed in different places in your
view hierarchy.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/43213aca964a57e9e448a7fe735bad26/d6a86/rn-article-nested-views.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABrElEQVQoz22SSY/TQBCF8/9/AQdOcABpRiCxSGiGGxlAHuQozjKeSTLeEu/xns2J/aG2QxIEh6fq19Vd/aped5YZhGmNiH+jbvbjDBZBjR3WRCkESXv+fxD3On8WXnJANj0e3YRFVJLkYPh7Po8mvOn1uOr3uVYG9MyEdAVRDnEOUdZGAVGrKSiSbnRAnqZM7A3qfI0TVRjBntfKN16pX3k5uuWF8oWb8QTPLzH9AjMssJZrjCDHCldnhUFSE4h2VhAeRyBeHukxt0qPX9Mhmv3Mg/FId6zj+LtTwflygx7kmOGqVThztozMNapVMLwfoBo5Y2vDxCqQH+a8vZN4J90zt/uoRhdZd8jWNG2nRYusaLlo+zTDMKlwZhZhcmhUiuSTvWWkD0mXKl1V4lq6Q9Y93AimzhbDL5uxiKh5O8ygpBNeuBytW4cFF6ZM3RJF15i7Ft+fZlz9kLmRxtjBnmd3hxWUDLsS2qJA9/eYfnmhsLG+On0BoXDmlnwaZLzvx3wYxHwcpvyc5iR5TVwcXY62xNmZd/79f2fFXlyh+Qd0vzrBji4F1EcTz/w3HY+gdNJBWtsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;picture&gt;
          &lt;source
              srcset=&quot;/static/43213aca964a57e9e448a7fe735bad26/577d7/rn-article-nested-views.webp 300w,
/static/43213aca964a57e9e448a7fe735bad26/93ccb/rn-article-nested-views.webp 600w,
/static/43213aca964a57e9e448a7fe735bad26/1aa16/rn-article-nested-views.webp 1200w,
/static/43213aca964a57e9e448a7fe735bad26/daa23/rn-article-nested-views.webp 1800w,
/static/43213aca964a57e9e448a7fe735bad26/54426/rn-article-nested-views.webp 1884w&quot;
              sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
              type=&quot;image/webp&quot;
            /&gt;
          &lt;source
            srcset=&quot;/static/43213aca964a57e9e448a7fe735bad26/37b9b/rn-article-nested-views.png 300w,
/static/43213aca964a57e9e448a7fe735bad26/ab3c7/rn-article-nested-views.png 600w,
/static/43213aca964a57e9e448a7fe735bad26/5c837/rn-article-nested-views.png 1200w,
/static/43213aca964a57e9e448a7fe735bad26/2f4db/rn-article-nested-views.png 1800w,
/static/43213aca964a57e9e448a7fe735bad26/d6a86/rn-article-nested-views.png 1884w&quot;
            sizes=&quot;(max-width: 1200px) 100vw, 1200px&quot;
            type=&quot;image/png&quot;
          /&gt;
          &lt;img
            class=&quot;gatsby-resp-image-image&quot;
            src=&quot;/static/43213aca964a57e9e448a7fe735bad26/5c837/rn-article-nested-views.png&quot;
            alt=&quot;rn article nested views&quot;
            title=&quot;rn article nested views&quot;
            loading=&quot;lazy&quot;
            decoding=&quot;async&quot;
            style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
          /&gt;
        &lt;/picture&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;When &lt;code class=&quot;language-text&quot;&gt;addView&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;insertReactSubview&lt;/code&gt; are called, you’ll just get a new view, and you have to do something with it (put it somewhere).&lt;/p&gt;
&lt;h3&gt;Identifying react subviews:&lt;/h3&gt;
&lt;p&gt;To identify each view, you can tag them on the react-native side with the &lt;code class=&quot;language-text&quot;&gt;nativeID&lt;/code&gt; property.&lt;/p&gt;
&lt;p&gt;This way, when you get that view on the native side, you can use that to figure out where should you place it.&lt;/p&gt;
&lt;p&gt;On &lt;strong&gt;android&lt;/strong&gt;, you need to use the react’s android library to do that via the
&lt;code class=&quot;language-text&quot;&gt;ReactFindViewUtil.findView(view, &quot;nativeId&quot;)&lt;/code&gt;. It will help you identify if a particular view has the
given &lt;code class=&quot;language-text&quot;&gt;nativeID&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;On &lt;strong&gt;iOS&lt;/strong&gt; that’s a bit easier. You have access to the view’s &lt;code class=&quot;language-text&quot;&gt;nativeID&lt;/code&gt; directly via &lt;code class=&quot;language-text&quot;&gt;subview.nativeID&lt;/code&gt; property.&lt;/p&gt;
&lt;h3&gt;Laying Them Out:&lt;/h3&gt;
&lt;p&gt;To lay out these components accordingly, what I suggest is limiting them to a slot on your native implementation.
This way, the native side can stay in control of its own ui. You assign each of these possible subviews a slot on
your view hierarchy.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Kotlin Multiplatform under the surface]]></title><description><![CDATA[The mobile development community always had many alternatives for creating cross-platform apps. Since the days of webview-based solutions we…]]></description><link>https://iurysza.github.com/thoughtbox/kotlin-multiplatform-under-the-surface/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/kotlin-multiplatform-under-the-surface/</guid><pubDate>Wed, 18 Aug 2021 08:00:00 GMT</pubDate><content:encoded>&lt;p&gt;The mobile development community always had many alternatives for creating cross-platform apps. Since the days of webview-based solutions we’ve come a long way, but we still have many alternatives. The most recent one is the Jetbrains led, Kotlin Multiplatform Mobile project.&lt;/p&gt;
&lt;p&gt;If you’re curious about how does it stand against the competition and what are its pros and cons, this brief overview may help you get started.&lt;/p&gt;
&lt;h2&gt;Cross-platform vs Multiplatform&lt;/h2&gt;
&lt;p&gt;As you may have noticed, Jetbrains calls its solution: Kotlin &lt;strong&gt;Multiplatform&lt;/strong&gt; Mobile. This might get overlooked by a lot of people, me included, up until I decided to write this down. But then it hit me: what’s the difference between Cross-platform and Multiplatform?&lt;/p&gt;
&lt;p&gt;After some research, I got the answer.
From the user’s point of view, this is plain simple. In short: there’s no difference.
Multiplatform and Cross-platform implementations achieve the same thing. It simply means that the application will run on - you guessed it. Multiple platforms.&lt;/p&gt;
&lt;p&gt;Since we’re focusing on mobile dev, Multiplatform means Android and iOS. But this can translate to web, desktop… whatever. Just… multiple platforms.
It doesn’t say anything about &lt;strong&gt;how&lt;/strong&gt; the app was created. If you have a code-base for an app written in Kotlin targeting android and another written in swift targeting iOS, you have a multiplatform app.&lt;/p&gt;
&lt;p&gt;Now, cross-platform is different. Cross-platform means that the same code you wrote will run on, for example, android and iOS. This is usually done via some kind of runtime that needs to be shipped to the hosting platform that enables that code to be &lt;em&gt;interpreted&lt;/em&gt; for that particular environment it is running on.&lt;/p&gt;
&lt;h2&gt;So what about Kotlin Multiplatform?&lt;/h2&gt;
&lt;p&gt;The main idea behind Kotlin Multiplatform is &lt;strong&gt;code-sharing&lt;/strong&gt;. If you enter the home page, you’ll see them mentioning how you can write the code once and have it running on both platforms. So -you may be asking, isn’t that cross-platform… like Flutter or React? What gives?&lt;/p&gt;
&lt;p&gt;The main advantage of Kotlin Multiplatform is that it delivers &lt;strong&gt;native code&lt;/strong&gt; for multiple target platforms/architectures by taking the same code as input.
It is able to do this because of the &lt;strong&gt;Kotlin/Native Compiler&lt;/strong&gt;, so to understand how Kotlin Multiplatform works we first need to understand what is Kotlin/Native.&lt;/p&gt;
&lt;h2&gt;Kotlin/Native&lt;/h2&gt;
&lt;p&gt;Quoting from Kotlin’s landing page:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Kotlin/Native is a technology for compiling Kotlin code to native binaries, which can run without a virtual machine. It is an LLVM based backend for the Kotlin compiler and a native implementation of the Kotlin standard library.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://dev-to-uploads.s3.amazonaws.com/uploads/articles/flnyeb40col3h8mvye69.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;p&gt;There’s a lot to unpack here. Let’s take the first sentence in:&lt;/p&gt;
&lt;p&gt;So Kotlin/Native will give us native binary executables that can run on an OS using no virtual machine.&lt;/p&gt;
&lt;p&gt;A binary is the machine code, ready to be run on the specified target architecture. So it’s the machine code for, for example, the iOS targeting a specific CPU architecture, like &lt;code class=&quot;language-text&quot;&gt;arm64&lt;/code&gt; (which is the official iPhone architecture name)&lt;/p&gt;
&lt;p&gt;Then it goes on to mention an &lt;strong&gt;LLVM based backend for the Kotlin compiler&lt;/strong&gt;. This one is dense.&lt;/p&gt;
&lt;h3&gt;LLVM&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://llvm.org/&quot;&gt;The LLVM Compiler Infrastructure Project&lt;/a&gt; is probably the biggest open-source compiler project that exists to build native binaries. Languages such as C, C++, Haskell, Rust &amp;#x26; Swift compile into native binaries through LLVM.&lt;/p&gt;
&lt;p&gt;Ok, fine… but what about the backend?  More specifically, what is a backend for a compiler?&lt;/p&gt;
&lt;h3&gt;The Kotlin Compiler, frontends, and backends&lt;/h3&gt;
&lt;p&gt;The Kotlin compiler first compiles your Kotlin source code into an &lt;em&gt;Intermediate Representation&lt;/em&gt;, or &lt;em&gt;IR&lt;/em&gt;. This is what they call the &lt;em&gt;Frontend&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Then, the LLVM compiler takes this IR as input and generates machine code for several supported CPU architecture (like the aforementioned arm64). This is the compiler backend.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://dev-to-uploads.s3.amazonaws.com/uploads/articles/6cgqfc6h6ryysfio80wn.png&quot; alt=&quot;Alt Text&quot;&gt;&lt;/p&gt;
&lt;h2&gt;Batteries included&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;(…) and a native implementation of the Kotlin standard library.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This last part refers to the stdlib. Kotlin multiplatform also includes a sound standard library. This allows us to get up and running with it. So when writing common code, we’ll be using things like &lt;code class=&quot;language-text&quot;&gt;kotlin.String&lt;/code&gt; instead of &lt;code class=&quot;language-text&quot;&gt;java.lang.String&lt;/code&gt;. The &lt;em&gt;Compiler Backend&lt;/em&gt; will automatically map the IR  a &lt;code class=&quot;language-text&quot;&gt;Kotlin.String&lt;/code&gt; into the correct type.&lt;/p&gt;
&lt;p&gt;If you think about it, since the native side doesn’t have access to, for example, &lt;code class=&quot;language-text&quot;&gt;List&lt;/code&gt;, this means you would have to roll your own when targeting that platform. Not cool.
So the Kotlin team built this to enable us to hit the ground running when targeting native. They also did that for things like IO, networking, and more - all of which are included.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Kotlin.String   ----jvm-----&gt; java.lang.String
                -----js-----&gt; string
                ---native---&gt; KString&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Long story short&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;The Kotlin Compiler compiles code into an Intermediate Representation with the Compiler Frontend&lt;/li&gt;
&lt;li&gt;Then, it takes this &lt;em&gt;IR&lt;/em&gt; and sends it to the LLVM based Compiler Backend.&lt;/li&gt;
&lt;li&gt;Kotlin has a stdlib that covers most basic use-cases, like IO and networking which is compiled to the appropriate target representation.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Not Cross-platform, but truly Multiplatform&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;Write once, run anywhere (with the jve).&lt;/em&gt;
&lt;em&gt;-java&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Kotlin, probably:
&lt;img src=&quot;https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ms3j71np9sy75jovxnrp.png&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Kotlin Multiplatform takes advantage of its great tooling paired with the amazing LLVM project to create true native code that you only need to write once.&lt;/p&gt;
&lt;p&gt;It is not Cross-platform because it doesn’t need a runtime to be able to run anywhere. It is just plain native code.&lt;/p&gt;
&lt;p&gt;Cool, right?
I would say that Kotlin is able to take that direction because of its tooling/architecture and the stage that LLVM project has achieved. Let’s see what the future holds for this tech.
There are certainly many challenges that we haven’t discussed here, but anyways, the foundation of the tech looks pretty interesting to me.&lt;/p&gt;
&lt;p&gt;There’s this &lt;a href=&quot;https://www.youtube.com/watch?v=Dul17VSiejo&quot;&gt;talk&lt;/a&gt; from KotlinConf18 by Kevin Galligan where he goes on to make the case for this multiplatform idea and why he thinks this is &lt;em&gt;the future&lt;/em&gt;.
I also recommend this great [post](&lt;a href=&quot;https://blog.londogard.com/gradle/kotlin/workshop/multiplatf&quot;&gt;https://blog.londogard.com/gradle/kotlin/workshop/multiplatf&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[A Continuous Integration approach for Kotlin projects]]></title><description><![CDATA[Continuous integration Continuous integration is one of the words that you often hear nowadays. I remember not really getting it when I…]]></description><link>https://iurysza.github.com/thoughtbox/continuous-integration-approach-for-kotlin/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/continuous-integration-approach-for-kotlin/</guid><pubDate>Sun, 24 Jan 2021 23:46:37 GMT</pubDate><content:encoded>&lt;h1&gt;Continuous integration&lt;/h1&gt;
&lt;p&gt;Continuous integration is one of the words that you often hear nowadays. I remember not really getting it when I first read about it. I think that most people don’t get it right away. It’s one of those things that you don’t see the benefit before you need it, like an insurance or a sun lotion.&lt;/p&gt;
&lt;p&gt;So, let’s try to tackle this one once again. What is &lt;strong&gt;Continuous Integration&lt;/strong&gt;?
Integrate what? And why should we continually do it?&lt;/p&gt;
&lt;p&gt;As you can see, there’s clearly something missing in this term: the subject. Maybe it should be called Continuous &lt;strong&gt;CODE&lt;/strong&gt; Integration, but that may not sound so appealing.
Now you might be wondering what this &lt;em&gt;integration&lt;/em&gt; is. Here it refers to code merging. Let’s jump to a full definition:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Continuous Integration (CI) is a phase in the software development cycle where code from different team members or different features are integrated together. This usually involves merging code (integration), building the application and carrying out basic tests all within an ephemeral environment.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Successful Continuous integration means new code changes to an app are regularly built, tested, and merged to a shared repository. It aims to improve the quality of software, and to reduce the time taken to deliver it, by replacing the traditional practice of applying quality control after completing all development.&lt;/p&gt;
&lt;p&gt;It’s also a solution to the problem of having too many branches of an app in development at once that might conflict with each other.
The main benefits here is making sure that the code quality doesn’t decrease while keep this process small and automated.&lt;/p&gt;
&lt;p&gt;You can check my DevOps series articles, where I go deeper about some concepts behind CI and automation.
[A Primer]&lt;a href=&quot;https://github.com/iurysza/thoughtbox/devops-primer/&quot;&gt;https://github.com/iurysza/thoughtbox/devops-primer/&lt;/a&gt;)
&lt;a href=&quot;https://github.com/iurysza/thoughtbox/devops-the-first-way/&quot;&gt;The First Way&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;Pipelines&lt;/h1&gt;
&lt;p&gt;The &lt;strong&gt;pipeline&lt;/strong&gt; is another loaded term. We lend its usage from the lean manufacturing process. The basic intuition is that each software change should go through an automated code quality verification assembly line instead of using a manual, artisan like approach to review the changes.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://mir-s3-cdn-cf.behance.net/project_modules/disp/c0843a20257383.562e8608353ac.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;To achieve that we need a clear process to guarantee software quality after every change.
CI pipelines can vary a lot depending on tools, type of project and many other factors, but a common flow has these steps.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pushing to the code repository&lt;/li&gt;
&lt;li&gt;Running Static code analysis&lt;/li&gt;
&lt;li&gt;Unit testing&lt;/li&gt;
&lt;li&gt;Manual code revision&lt;/li&gt;
&lt;li&gt;Merge code on the main branch&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn-images-1.medium.com/max/800/0*Ibsu7Nvvd9gyhHxO.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1&gt;An android library example&lt;/h1&gt;
&lt;p&gt;CI/CD tools can help a team automate their development, deployment, and testing. Some tools specifically handle the integration (CI) side, some manage development and deployment (CD), while others specialize in continuous testing or related functions.&lt;/p&gt;
&lt;p&gt;One of the best known open source tools for CI/CD is the automation server Jenkins. Jenkins is designed to handle anything from a simple CI server to a complete CD hub.&lt;/p&gt;
&lt;p&gt;You can even use GitHub with Jenkins, via the &lt;a href=&quot;https://github.com/jenkinsci/ghprb-plugin&quot;&gt;ghprb-plugin&lt;/a&gt; to set up a pipeline workflow to be triggered after a Pull Request is opened.&lt;/p&gt;
&lt;p&gt;Let’s take a look at how this flow works on an android library project.&lt;/p&gt;
&lt;h2&gt;Our Pipeline&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://dl3.pushbulletusercontent.com/aI7mb8Wt1NnUE9Dl4EWnOEldlWmWvSwK/image.png&quot; alt=&quot;&quot;&gt;
This is an overview of our final pipeline. Now let’s see what each &lt;em&gt;stage&lt;/em&gt; does.&lt;/p&gt;
&lt;h2&gt;Opening a Pull Request&lt;/h2&gt;
&lt;p&gt;This is the starting point. Developers should open a pull request where they explain the context of ther code changes. Every project have their own pull request process and that should be clear to everybody contributing on to the code-base.
This pull request should trigger a CI build. While that happens, other developers can contribute to the PR making questions and reviewing the code.&lt;/p&gt;
&lt;h2&gt;Merge&lt;/h2&gt;
&lt;p&gt;Your integration server will then checkout the code on your branch and merge with the main branch. If there are issues here, your build will fail and that is reported directly on the PR.&lt;/p&gt;
&lt;h2&gt;Static analysis&lt;/h2&gt;
&lt;p&gt;In this pipeline this stage does two things using the same tool:&lt;/p&gt;
&lt;h4&gt;Code Review Automation&lt;/h4&gt;
&lt;p&gt;To improve the code review process you can automate some parts of it. To do that you can use &lt;a href=&quot;https://danger.systems/&quot;&gt;Danger&lt;/a&gt;. This tool “provides another logical step in your build, through this &lt;code class=&quot;language-text&quot;&gt;Danger&lt;/code&gt; can help &lt;em&gt;lint&lt;/em&gt; your rote tasks in daily code review.” This way you can codify your team norms. E.G.: PRs with no description or with no tests are instantly reported back directly on the PR, speeding up the review process.&lt;/p&gt;
&lt;img width=&quot;75%&quot; src=&quot;https://danger.systems/images/danger-screenshot-074f084c.png&quot;&gt;
&lt;h4&gt;Actual static analysis&lt;/h4&gt;
&lt;p&gt;Static analysis is done on the code base of the application without the need to run the software. The goal here is to ensure the code doesn’t have bugs and conforms to standard formatting and styling. You might want to check this &lt;a href=&quot;link&quot;&gt;article&lt;/a&gt; I’ve written about it with my approach for Kotlin projects.&lt;/p&gt;
&lt;p&gt;Ideally, developers should have fast feedback for issues during this step, so they can start fixing them ASAP.
To do that, I’ve forked the &lt;a href=&quot;github.com/iurysza/danger-checkstyle_format&quot;&gt;danger-checkstyle-format&lt;/a&gt; plugin and added some changes to enable reporting issues from both &lt;code class=&quot;language-text&quot;&gt;ktlint&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;detekt&lt;/code&gt; directly on the PR, making developer iteration faster. Check it out.&lt;/p&gt;
&lt;h2&gt;Build&lt;/h2&gt;
&lt;p&gt;In this step we use a gradle task to build our code.&lt;/p&gt;
&lt;h2&gt;Test&lt;/h2&gt;
&lt;p&gt;Here we run all unit tests, also with gradle.&lt;/p&gt;
&lt;h2&gt;Publish reports&lt;/h2&gt;
&lt;p&gt;This step happens after the pipeline has finished. It runs &lt;a href=&quot;https://plugins.jenkins.io/jacoco/&quot;&gt;jacoco jenkins plugin&lt;/a&gt;, a java code coverage tool to create coverage reports, then we store the test results in Jenkins. This provides a way for us to track code coverage and investigate flaky tests later on.&lt;/p&gt;
&lt;h2&gt;Bonus&lt;/h2&gt;
&lt;p&gt;You can also add some basic commands to your Jenkins pipeline, like the &lt;code class=&quot;language-text&quot;&gt;rebuild&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;rerun-tests&lt;/code&gt; commands. To help you work around flakiness on your project’s build or testing stages.&lt;/p&gt;
&lt;h1&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;The benefits you get from having a CI pipeline in place pile up like Loan Shark interests. I strongly advise that you and your team consider creating one. If you already have one, I’d love to hear some other stages or ideas you’ve added to it. Please share in the comments =)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Publishing an obfuscated kotlin library]]></title><description><![CDATA[Being an android developer, I’ve heard about code obfuscation pretty early in my career. Since it’s preconfigured in android’s gradle plugin…]]></description><link>https://iurysza.github.com/thoughtbox/publishing-an-obfuscated-kotlin-library/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/publishing-an-obfuscated-kotlin-library/</guid><pubDate>Sun, 27 Dec 2020 23:46:37 GMT</pubDate><content:encoded>&lt;p&gt;Being an android developer, I’ve heard about code obfuscation pretty early in my career. Since it’s preconfigured in android’s gradle plugin (it’s actually proguard under the hood), but you don’t really mess with it unless you want to.
On the other hand, when you’re developing a java/kotlin library and you want to use code obfuscation, things get a little different. In this article I wanted to give a brief overview of my strategy for publishing obfuscated kotlin libraries.&lt;/p&gt;
&lt;h1&gt;Code obfuscation&lt;/h1&gt;
&lt;p&gt;If you’re not sure what that means, code obfuscation is the modification of the source code to make it unintelligible, meaning it is &lt;em&gt;impossible&lt;/em&gt; for a third-party to understand.
It’s makes for a great AppSec initiative and often takes care of the bare minimum security you can have when publishing a source code out in they wild.  By making the code hard to reverse engineer, you ensure that your library’s intellectual property is guarded against security threats, unauthorized access, and discovery of application vulnerabilities.&lt;/p&gt;
&lt;h1&gt;Proguard&lt;/h1&gt;
&lt;p&gt;ProGuard is the most popular optimizer for Java bytecode and it also provides obfuscation for the names of classes, fields and methods.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.guardsquare.com/files/media/guardsquare2016/Website/ProGuard/ProGuard_build_process_b.png&quot; alt=&quot;proguard-pipeline&quot;&gt;&lt;/p&gt;
&lt;p&gt;Proguard is basically a command line tool that takes input jars (aars, wars, ears, zips, apks, directories) and then performs shriking, optimization, obfuscation and preverification to output a new jar.&lt;/p&gt;
&lt;p&gt;Here we’re just interested in the obfuscation step which will rename the classes, fields, and methods using short meaningless names making it really hard to read the code.&lt;/p&gt;
&lt;h1&gt;An obfuscation strategy&lt;/h1&gt;
&lt;h3&gt;Choosing our tools&lt;/h3&gt;
&lt;p&gt;There are probably many ways to do this, but since I have a mobile development background, we’ll be doing this using proguard’s gradle plugin, which will make things are little more simple, specially during the &lt;em&gt;publication&lt;/em&gt; part. Also, I’ll use gradle’s groovy dsl, just because I like its convenience better than kotlin’s now (for gradle scripts). I may need another article to justify that, but, bear with me. This is how we integrate proguard’s gradle plugin:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;buildscript &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    repositories &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;jcenter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    dependencies &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        classpath &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.guardsquare:proguard-gradle:7.0.1&quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We now need to use it to obfuscate our library’s &lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt;. To do that we’re going to use gradle’s syntax to create a task that does just that.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;&lt;span class=&quot;token function&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;obfuscateArtifact&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ProGuardTask&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dependsOn&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; jar&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s dissec the task signature for a second. Here we’re declaring that this is a task of type &lt;code class=&quot;language-text&quot;&gt;ProguardTask&lt;/code&gt; and that it depends on &lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt; task, meaning it has to run &lt;em&gt;after&lt;/em&gt; it. This &lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt; task comes from either the kotlin or java plugin, that you’re already using and it is responsible for packaging your application artifacts into a jar file. The reason our &lt;code class=&quot;language-text&quot;&gt;obfuscateArtifact&lt;/code&gt; task needs to run after this one can be seen in the image above. Proguard takes a jar file as the input, so we need this task to create the jar and then we’ll apply our task on top of it.&lt;/p&gt;
&lt;p&gt;Now let’s configure the input/output of our task:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; artifactName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;libraryArtifactId&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;libraryVersion&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.jar&quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; obfuscatedFolder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;buildDir&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/obfuscated&quot;&lt;/span&gt;&lt;/span&gt;

injars &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;buildDir&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/libs/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;artifactName&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
outjars &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;obfuscatedFolder&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;artifactName&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt; task will create, by default, the outputfile file in &lt;code class=&quot;language-text&quot;&gt;buildDir/libs&lt;/code&gt; folder. By default, its name follows the pattern: &lt;code class=&quot;language-text&quot;&gt;artifactId-version.jar&lt;/code&gt;. The &lt;code class=&quot;language-text&quot;&gt;artifactId&lt;/code&gt; is defined in the publishing task that we’ll see later on. It’s useful to have those values as variables declared in a &lt;code class=&quot;language-text&quot;&gt;gradle.properties&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;Next properties are for handling deobfuscation. These are meant to be used when you want to understand your stacktraces.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;printseeds &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;obfuscatedFolder&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/seeds.txt&quot;&lt;/span&gt;&lt;/span&gt;
printmapping &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;obfuscatedFolder&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/mapping.txt&quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Handling dependencies&lt;/h3&gt;
&lt;p&gt;After that, we have to make proguard understand our project’s dependencies. To do that we need to provide it with java’s standard library and ours runtime, and compile-time  dependencies. A quick explanation of the last two:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;code class=&quot;language-text&quot;&gt;compile-time&lt;/code&gt; classpath contains the classes that you’ve added in order to compile your code. This is the equivalent of the classpath passed to &lt;code class=&quot;language-text&quot;&gt;javac&lt;/code&gt; (or any other java compiler).&lt;/li&gt;
&lt;li&gt;The &lt;code class=&quot;language-text&quot;&gt;runtime:&lt;/code&gt; classpath contains the classes that are used when your application is running. That’s the classpath passed to the &lt;code class=&quot;language-text&quot;&gt;java&lt;/code&gt; executable. This is all the code your library is using when it’s running.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In proguard we can use the &lt;code class=&quot;language-text&quot;&gt;libraryjars&lt;/code&gt; property to provide these dependencies:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;libraryjars &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;java.home&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/lib/rt.jar&quot;&lt;/span&gt;&lt;/span&gt;
libraryjars configurations&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;runtime
libraryjars sourceSets&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;compileClasspath&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first line has a path pointing to a &lt;code class=&quot;language-text&quot;&gt;rt.jar&lt;/code&gt;. This stands for &lt;code class=&quot;language-text&quot;&gt;runtime JAR&lt;/code&gt; and it has all the classes from the Core Java API. This is the path you use when you’re targeting java 8 and below. The other two lines handles runtime and compile-time dependencies that we get by using gradle’s dsl.&lt;/p&gt;
&lt;h3&gt;Wrapping up&lt;/h3&gt;
&lt;p&gt;The last piece of this puzzle is proguard’s configuration file. I prefer doing that in a separated file. If you’re using intelij you can get nice syntax highlight for this file, which in my book is always a nice to have.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;configuration &lt;span class=&quot;token function&quot;&gt;files&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;projectDir&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/gradle/configuration.pro&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The configuration you’re going to use is up to you, even if you don’t add anything in the config file, proguard will handle code obfuscation by default. We’ll come back to this file again.&lt;/p&gt;
&lt;p&gt;Ok, now if you want to obfuscate your code you just need to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;run &lt;code class=&quot;language-text&quot;&gt;jar&lt;/code&gt; task&lt;/li&gt;
&lt;li&gt;run &lt;code class=&quot;language-text&quot;&gt;obfuscateArtifact&lt;/code&gt; task&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Problem solved! Or maybe not.&lt;/p&gt;
&lt;h1&gt;Automating the publication pipeline&lt;/h1&gt;
&lt;p&gt;Assuming you get the &lt;code class=&quot;language-text&quot;&gt;artifactId&lt;/code&gt; right, what we did until now may actually work for youu. The obfuscate task will trigger a build and then obfuscate the jar. But that’s not ideal. We don’t want to manually run this specific task every time. To me, the obfuscation step should be just a part of our library’s publication pipeline now. We shouldn’t have to remember about it anymore. In order to fix this we need to take a look at this so called, publication pipeline.&lt;/p&gt;
&lt;p&gt;If you already have one, it may be just a simple &lt;code class=&quot;language-text&quot;&gt;publishing&lt;/code&gt; task, something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;group &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.myLibrary.group.&quot;&lt;/span&gt;&lt;/span&gt;
version &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;myLibraryVersion&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;

publishing &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    publications &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MavenPublication&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            artifactId &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;myLibraryArtifactId&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            from components&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;java&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;My Library&apos;s name&quot;&lt;/span&gt;&lt;/span&gt;
            description &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;My Library&apos;s description&quot;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The key here is the &lt;code class=&quot;language-text&quot;&gt;from components[&quot;java&quot;]&lt;/code&gt; declaration. Quoting from gradle’s docs:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Components are defined by plugins and provide a simple way to define a publication for publishing. They comprise one or more artifacts as well as the appropriate metadata. For example, &lt;strong&gt;the java component consists of the production JAR — produced by the jar task — and its dependency information&lt;/strong&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So, this is how our publication task gets the project’s artifacts and dependencies. Therefore, if we want to publish an obfuscated library we need to remove that line and provide our publication with the output produced by &lt;code class=&quot;language-text&quot;&gt;obfuscateArtifact&lt;/code&gt; task.&lt;/p&gt;
&lt;p&gt;So, how can we do that?
As we saw in the documentation the &lt;code class=&quot;language-text&quot;&gt;components[&quot;java&quot;]&lt;/code&gt; is automatically defined by the java/kotlin plugin and includes all classes from the default &lt;code class=&quot;language-text&quot;&gt;sourceSets&lt;/code&gt;. If we want to define our own artifacts that we want to be published, we can use the &lt;code class=&quot;language-text&quot;&gt;artifact&lt;/code&gt; property.
This is how you do it, inside the &lt;code class=&quot;language-text&quot;&gt;create&lt;/code&gt; block, add:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;&lt;span class=&quot;token function&quot;&gt;artifact&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;buildDir&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/obfuscated/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;libraryArtifactId&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.jar&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    builtBy obfuscateArtifact
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, let’s read this backwards:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;builtBy&lt;/code&gt; tells which task is going to build the artifact&lt;/li&gt;
&lt;li&gt;the argument to the &lt;code class=&quot;language-text&quot;&gt;artifact&lt;/code&gt; function is the path where this task is going to output it. This path was defined earlier by the &lt;code class=&quot;language-text&quot;&gt;outputJar&lt;/code&gt; property, in our &lt;code class=&quot;language-text&quot;&gt;obfuscateArtifact&lt;/code&gt; task.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Almost there! Now, we need to provide the dependency information. This comes automatically when using the &lt;code class=&quot;language-text&quot;&gt;components[&quot;java&quot;&lt;/code&gt;, but here we need to manually provide it. Still in the &lt;code class=&quot;language-text&quot;&gt;create&lt;/code&gt; block, add:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;pom&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;withXml &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; dependencies &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;asNode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;appendNode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dependencies&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    configurations&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;implementation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;allDependencies&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;each &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; dep &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; depNode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; dependencies&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;appendNode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dependency&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        depNode&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;appendNode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;groupId&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dep&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;group&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        depNode&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;appendNode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;artifactId&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dep&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        depNode&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;appendNode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dep&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;version&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And that’s about it!
Now, we can forget about obfuscation. We just run the publish task and get our obfuscated code published seamlessly.&lt;/p&gt;
&lt;h2&gt;Naming conflicts&lt;/h2&gt;
&lt;p&gt;If you’re using this library in another codebase that will also obfuscate its code you might get some naming conflicts due to proguard using the same name for classes/methods in that projects own obfuscation process. To fix this you can provide proguard with a custom dictionary.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;txt&quot;&gt;&lt;pre class=&quot;language-txt&quot;&gt;&lt;code class=&quot;language-txt&quot;&gt;//class-dictionary.txt
Lorem
ipsum
dolor
sit
amet
consectetur
adipiscing
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You’ll then need tell proguard about it in the &lt;code class=&quot;language-text&quot;&gt;configuration.pro&lt;/code&gt; file, by adding the line.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;pro&quot;&gt;&lt;pre class=&quot;language-pro&quot;&gt;&lt;code class=&quot;language-pro&quot;&gt;-classobfuscationdictionary class-dictionary.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, proguard will use the words in that file to name our classes during the obfuscation step, avoiding naming conflicts.&lt;/p&gt;
&lt;p&gt;The last thing I like to do is to create a different &lt;code class=&quot;language-text&quot;&gt;artifactId&lt;/code&gt; for the unobfuscated version of the library and to publish both versions. You can see the complete script in this &lt;a href=&quot;https://gist.github.com/iurysza/8b1dfb998bb9054cd708043a55f8e227&quot;&gt;gist&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This diagram shows our end product.
&lt;img src=&quot;https://dev-to-uploads.s3.amazonaws.com/i/628lwza2a5nacpjkur1l.png&quot; alt=&quot;diagram&quot;&gt;&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.guardsquare.com/en/products/proguard&quot;&gt;Proguard home page&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Continuous Kotlin Static Analysis]]></title><description><![CDATA[What is it anyway? Static analysis is a way to find errors and other issues in a source code without actually executing it (hence, static…]]></description><link>https://iurysza.github.com/thoughtbox/continuous-kotlin-static-analysis/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/continuous-kotlin-static-analysis/</guid><pubDate>Sun, 20 Dec 2020 23:46:37 GMT</pubDate><content:encoded>&lt;h1&gt;What is it anyway?&lt;/h1&gt;
&lt;p&gt;Static analysis is a way to find errors and other issues in a source code without actually executing it (hence, static). The process provides an understanding of the code structure and can help ensure that the code adheres to industry standards and capture issues early.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In sum, it’s a glorified spellchecker.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is not a new idea, the first one of these tools is &lt;a href=&quot;https://www.wikiwand.com/en/Lint_(software)&quot;&gt;lint&lt;/a&gt; which dates back from the late 70’s and is the most common kind of static analysis tool. Most languages have a &lt;em&gt;linter&lt;/em&gt; nowadays.
The automation provided by these tools is fundamental to improve code quality, as it greatly increase code reviewing speed while also being less prone to human error.&lt;/p&gt;
&lt;h4&gt;Let machines do what they’re best at!&lt;/h4&gt;
&lt;img width=&quot;100%&quot; style=&quot;width:100%&quot; src=&quot;https://thumbs.gfycat.com/AchingOptimisticAlabamamapturtle-size_restricted.gif&quot;&gt;
&lt;h3&gt;What can it do?&lt;/h3&gt;
&lt;p&gt;Static analysis can be broken into formal, cosmetic, design properties, error checking and predictive categories.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Formal&lt;/strong&gt;  checks if the code is correct;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Cosmetic&lt;/strong&gt; checks if the code syncs up with style standards;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Design properties&lt;/strong&gt; check the level of complexities;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Error checking&lt;/strong&gt; looks for code violations;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Predictive&lt;/strong&gt; guesses how code will behave when run.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;But who needs this anyway?&lt;/h1&gt;
&lt;p&gt;In short, everyone does. Quoting John Carmack, lead developer of Wolfenstein, Doom, Quake and their sequels:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The first step is fully admitting that the code you write is riddled with errors. That is a bitter pill to swallow for a lot of people, but without it, most suggestions for change will be viewed with irritation or outright hostility. You have to want criticism of your code.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Automation is necessary. It is common to take a sort of smug satisfaction in reports of colossal failures of automatic systems, but for every failure of automation, the failures of humans are legion. Exhortations to “write better code” plans for more code reviews, pair programming, and so on just don’t cut it, especially in an environment with dozens of programmers under a lot of time pressure. The value in catching even the small subset of errors that are tractable to static analysis every single time is huge.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1&gt;First Quality Gate&lt;/h1&gt;
&lt;img width=&quot;75%&quot; style=&quot;width:75%&quot; src=&quot;https://static.wikia.nocookie.net/ageofempires/images/e/e0/Palisadegate.png/revision/latest/top-crop/width/450/height/450?cb=20170112132848&quot;&gt;
&lt;p&gt;Static code analysis is a common DevOps practice and makes for a great first quality gate, since it provides early feedback for developers making it easier to fix issues.
So, if you’ve reached this far, I’m hoping that I was able to convince you, but how can we get static analysis added to your project?&lt;/p&gt;
&lt;h1&gt;Kotlin static analysis landscape&lt;/h1&gt;
&lt;p&gt;So, in the Kotlin community two tools usually come up when talking about static analysis: &lt;a href=&quot;https://github.com/pinterest/ktlint&quot;&gt;ktlint&lt;/a&gt; and &lt;a href=&quot;https://github.com/detekt/detekt&quot;&gt;detekt&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ktlint&lt;/code&gt; prides itself for taking a &lt;em&gt;no-configuration&lt;/em&gt; approach to linting. The idea is that it will always reflect kotlin’s &lt;a href=&quot;https://kotlinlang.org/docs/reference/coding-conventions.html&quot;&gt;official code style&lt;/a&gt; so the idea here is to be a cosmetic static analysis tool.
&lt;code class=&quot;language-text&quot;&gt;Detekt&lt;/code&gt; on the other hand provides many other features like complexity reports, code smell analysis while also being extensively configurable.&lt;/p&gt;
&lt;h1&gt;Basic integration pitfalls&lt;/h1&gt;
&lt;p&gt;Both tools provide many ways to integrate in your project. You can add a plain gradle task, a gradle plugin or install the command line interface. The recommended route is via a gradle plugin.
After integrating these tools in your project you can use tasks like &lt;code class=&quot;language-text&quot;&gt;detektCheck&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;ktlintCheck&lt;/code&gt; to run over all your project and report the issues. And that’s it, you’re done!&lt;/p&gt;
&lt;h5&gt;Yes, but also no.&lt;/h5&gt;
&lt;p&gt;The problem with the basic integration is that in real life things tend to be a little different.
If you’re adding static analysis to a greenfield project, it’s usually fine to run those tasks over the whole project, but if that is not your case, you’ll probably want to avoid auto-formatting your whole project or getting 5k+ warnings every time you run one of those tasks. Warnings just turn into noise.
You could use a &lt;em&gt;baseline&lt;/em&gt;, which is a configuration that helps incremental adoption on a project, but you’re still going to stumble in some issues related to running these over your whole codebase.&lt;/p&gt;
&lt;h2&gt;A better solution&lt;/h2&gt;
&lt;p&gt;If you stop and think about it to be able to get the benefits I’ve mentioned in the beginning of this post, ideally:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You want these tasks to run fast, so you can run them often.&lt;/li&gt;
&lt;li&gt;You want to incrementally adopt this in your codebase&lt;/li&gt;
&lt;li&gt;And last, but certainly not least: you don’t want to keep forgetting to run these tasks.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Configuring both tools is really similar, so I’ll highlight some points that happen in both scripts. You can get detekt’s &lt;a href=&quot;https://gist.github.com/iurysza/005c08ff7f1892097c2823b1786ac087&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;So, the magic here is to get the files that were changed in our commit&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There’s git command that does just that:
&lt;code class=&quot;language-text&quot;&gt;$ git diff --name-only origin/main --relative &lt;/code&gt; In line 38 we call it by using groovy’s api. This will output all the change files names.&lt;/li&gt;
&lt;li&gt;In line 44 we process the output so that we can pass the filename list to ktlint/detekt.&lt;/li&gt;
&lt;li&gt;From lines 13 to 20 we decide whether we need to run static analysis or just ignore all files.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;https://gist.github.com/iurysza/dada9047da83d101a6c4b63ed8407cb3&quot;&gt;ktlint.gradle-gist&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;And that’s about it! The rest of the code (from both scripts) just handles the report output location.&lt;/p&gt;
&lt;h4&gt;Good! Almost there now!&lt;/h4&gt;
&lt;p&gt;We just need a way to make this a part of our workflow. This way we won’t forget to run these tasks. And yeah, we can use a &lt;code class=&quot;language-text&quot;&gt;git-hook&lt;/code&gt; like the &lt;code class=&quot;language-text&quot;&gt;pre-commit&lt;/code&gt; hook to do just that.&lt;/p&gt;
&lt;p&gt;If you’re not familiar with git-hooks, you can check them &lt;a href=&quot;https://www.atlassian.com/git/tutorials/git-hooks&quot;&gt;here&lt;/a&gt;, but if you want to keep reading, just think about them as a piece of code that is going to be called when you do something in git.&lt;/p&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;pre-commit&lt;/code&gt; hook will run when you try to commit something. It runs before git actually creates the commit, so the idea is to only allow a new commit when our static analysis passes successfully, effectively creating our first quality gate. Woot woot!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://gist.github.com/iurysza/fc6d0b735089c573aa5b0ce8797ef548#file-pre-commit-hook&quot;&gt;precommit-hook-gist&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://media.giphy.com/media/IwAZ6dvvvaTtdI8SD5/giphy.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;That’s it! This makes sure that every piece of code you commit has to follow the minimum quality standards that you and your team agreed upon.
This is not yet a &lt;em&gt;final solution&lt;/em&gt; as people can bypass those checks by running &lt;code class=&quot;language-text&quot;&gt;git commit --no-verify&lt;/code&gt;, but it’s a solid first step towards a better codebase.&lt;/p&gt;
&lt;p&gt;Besides, if you think about it, these scripts can be easily integrated to a CI environment. What if it could send those warnings as inline comments in your pull request? Stay tuned for more =)&lt;/p&gt;
&lt;h4&gt;References&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://www.gamasutra.com/view/news/128836/InDepth_Static_Code_Analysis.php&quot;&gt;Carmac’s blog&lt;/a&gt;
&lt;a href=&quot;https://searchsoftwarequality.techtarget.com/definition/static-analysis-static-code-analysis&quot;&gt;Static analysis definition&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[The First Way]]></title><description><![CDATA[The idea behind the First Way is that by identifying, measuring, and improving the flow of work through our value stream, we can optimize…]]></description><link>https://iurysza.github.com/thoughtbox/devops-the-first-way/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/devops-the-first-way/</guid><pubDate>Thu, 17 Dec 2020 23:46:37 GMT</pubDate><content:encoded>&lt;p&gt;The idea behind the First Way is that by identifying, measuring, and improving the flow of work through our value stream, we can optimize and refine the ability to deliver value to our customers.&lt;/p&gt;
&lt;p&gt;The first step towards that is to split every piece of work in the value stream and automate it. This is often called a pipeline.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://digitize01.com/image/image_lib/images/CI-CD-Pipeline.png&quot; alt=&quot;pipeline&quot;&gt;&lt;/p&gt;
&lt;h1&gt;The foundation of our pipelines&lt;/h1&gt;
&lt;p&gt;You’re probably already using a build system to automate some parts of our value stream, but we can do better. Quoting from the Devops Handbook:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In order to create fast and reliable flow from Dev to Ops, we must ensure that we always use &lt;strong&gt;production-like environments&lt;/strong&gt; at every stage of the value stream. Furthermore, these environments must be created in an &lt;strong&gt;automated manner&lt;/strong&gt;, ideally on demand from &lt;strong&gt;scripts&lt;/strong&gt; and configuration information &lt;strong&gt;stored&lt;/strong&gt; in &lt;strong&gt;version control&lt;/strong&gt;, and entirely self-serviced, without any manual work required from Operations. Our goal is to ensure that we can &lt;strong&gt;re-create&lt;/strong&gt; the entire production environment based on what’s in version control.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The authors go on to say that we should enable on demand creation of dev, test, and production environments so developers can run production-like environments anywhere, even on their own computers, created on demand and self-serviced.&lt;/p&gt;
&lt;p&gt;This way, developers can run and test their code in a production-like environment as part of their daily work,
providing early and constant feedback on code quality.&lt;/p&gt;
&lt;p&gt;We’ve all been there before:
&lt;img src=&quot;https://4.bp.blogspot.com/_CywCAU4HORs/S-HYtX4vOkI/AAAAAAAAAHw/Hzi5PYZOkrg/s1600/ItWorksOnMyMachine.jpg&quot; alt=&quot;it works on my machine&quot;&gt;&lt;/p&gt;
&lt;p&gt;The “It works on my machine!” issue comes from the fact that in any complex system there’s just too many variables to manage. If you google &lt;em&gt;The Matrix of Hell&lt;/em&gt; you’ll might see something like this:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://files.speakerdeck.com/presentations/c5ce6ce091ee01319fc1623dfa5ee5e7/slide_6.jpg&quot; alt=&quot;Matrix from hell&quot;&gt;&lt;/p&gt;
&lt;p&gt;Different kind of applications will have different rows and columns in this table, but you get the idea: - Multiple environments with multiple third party dependencies, create a combinatorial explosion that no sane human being can manage.&lt;/p&gt;
&lt;p&gt;Most companies will have a test and production environments, maybe you even have a dev environment where you can safely run your app with the hottest new features. But as the project evolves, non-production environments tend to degrade. It’s hard for them to keep up with prod because of lack of automation or the discipline of constantly updating it. After a while the dev environment will have so many small things that work differently that it becomes hard to trust it. Some months down the line and people will stop believing anything that happens in the dev environment and only newcomers, still unaware of these issues, will be using it at all.&lt;/p&gt;
&lt;h1&gt;How to fix that?&lt;/h1&gt;
&lt;p&gt;The issue is that if these environments were manually created, you can’t expect people to maintain them equally.
By automating their creation we enable anyone to quickly spin up a new environment on demand, enabling every developer to have their own local environment when they need one.
The automation scripts will make sure that the correct configuration is loaded on each environment, avoiding hundreds or thousands of hours of unneeded headaches over a misconfiguration due to human error.&lt;/p&gt;
&lt;p&gt;This way we’re effectively giving the development team access to production-like environments by treating your infrastructure and configuration as code, making immutable infrastructure, ensuring where we operate, develop, and test is comparable and a reliable indicator of system operation for customers — such that new value contributed by developers can easily and predictably be deployed to customers.&lt;/p&gt;
&lt;h1&gt;It’s hard, but it pays in the long run!&lt;/h1&gt;
&lt;p&gt;&lt;img src=&quot;https://imgs.xkcd.com/comics/the_general_problem.png&quot; alt=&quot;xkcd&quot;&gt;&lt;/p&gt;
&lt;p&gt;This is not a simple issue to solve. And you should be mindful about when and where to start the process.&lt;/p&gt;
&lt;p&gt;In my experience, small startups or software studios tend to overlook this, because it’s too much to worry about this stuff at their product stage.&lt;/p&gt;
&lt;p&gt;If your project doesn’t have to scale, fine. You can get away from following these ideas in smaller projects, but the engineering team has to stay vigilant for when they should stop and implement a solution.&lt;/p&gt;
&lt;p&gt;If you get big enough the cost of not having on-demand, dev/prod environment parity will also scale, even faster than your product. And hiring more people will only make the cost increase.
Hundreds or thousands of development hours go down the drain because of this issue. Bugs that are impossible to reproduce make debugging even harder, fear of changing “buggy” parts of the application causes code quality to suffer and everybody suffers.&lt;/p&gt;
&lt;p&gt;Every team and organization is different and deciding when to start with this approach has to made in case by case scenario, but I’d argue that it’s certainly cost-effective to gradually implement this idea in the early stages of a project.&lt;/p&gt;
&lt;h4&gt;Create our single repository of truth for the entire system&lt;/h4&gt;
&lt;p&gt;To ensure that we can restore production service repeatedly and predictably (and, ideally, quickly) even when catastrophic events occur, we must check in all the assets needed to recreate the system state.&lt;/p&gt;
&lt;p&gt;That includes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;All application code and dependencies (e.g., libraries, static content, etc.)&lt;/li&gt;
&lt;li&gt;Any script used to create database schemas, application reference data, etc.&lt;/li&gt;
&lt;li&gt;All the environment creation tools and artifacts&lt;/li&gt;
&lt;li&gt;Any file used to create containers (e.g., Docker or composition files)&lt;/li&gt;
&lt;li&gt;All supporting automated tests and any manual test scripts&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ideally this should happen using immutable infrastructure where no manual changes occur - make it easier to destroy
and rebuild than to configure.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Encoding knowledge&lt;/strong&gt; and &lt;strong&gt;sharing&lt;/strong&gt; it through a repository is one of the powerful mechanism for propagating knowledge.
Particularly when it includes every library (internal or external), and those each have an owner responsible for ensuring it successfully passes all tests.&lt;/p&gt;
&lt;h1&gt;Wrapping up&lt;/h1&gt;
&lt;p&gt;We’ve seen how dev/prod parity begets automation. If you’re not yet embracing these concepts, well, you quite frankly should, or at least be aware of the issues that are coming your way.
But fret not! We’ve all been there and those who came out alive have some very interesting ideas about how to solve it. We just have to listen to them.&lt;/p&gt;
&lt;p&gt;Coming up next: Test automation! Stay tuned.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[A primer]]></title><description><![CDATA[Recently, I’ve been trying to improve my understanding of good CI and CD practices and I often saw this word: .
I mean, I thought I sort of…]]></description><link>https://iurysza.github.com/thoughtbox/devops-primer/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/devops-primer/</guid><pubDate>Wed, 16 Dec 2020 23:46:37 GMT</pubDate><content:encoded>&lt;p&gt;Recently, I’ve been trying to improve my understanding of good CI and CD practices and I often saw this word: &lt;code class=&quot;language-text&quot;&gt;DevOps&lt;/code&gt;.
I mean, I thought I sort of understood what DevOps meant: - The team who keeps our infrastructure up and running and that manages some crazy scripts for on our pipelines, right?  Well… no.&lt;/p&gt;
&lt;p&gt;So I decided to take some time to understand this. Picked a book on the subject, read some articles here and there…
And in this series I’ll try to talk about some of what I learned and about my own experiences.&lt;/p&gt;
&lt;p&gt;The book I picked up was &lt;em&gt;The DevOps Handbook&lt;/em&gt;, subtitled: &lt;em&gt;How to Create World-Class Agility, Reliability, &amp;#x26; Security in Technology Organizations&lt;/em&gt;. This is an incredible source of knowledge, written by some very smart folks from the DevOps community. After that, one thing led to another, and I stumbled upon &lt;em&gt;The Twelve-Factor App&lt;/em&gt;. This one is a methodology developed by people working for the Heroku platform. They provide key insights for anyone that develops software delivered as a service (SaaS), but a lot of what they talk about is useful for any kind of software. You should really check them out if you have the chance. But enough with that. Let’s dive in.&lt;/p&gt;
&lt;h1&gt;So, what is DevOps?&lt;/h1&gt;
&lt;p&gt;Quoting Wikipedia:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;DevOps is a set of practices that combines software development and IT operations.
It aims to shorten the system’s development life cycle and provide continuous delivery with high software quality.
DevOps is complementary with Agile software development; several DevOps aspects came from Agile methodology.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So, this is basically agile at a macro-level. When you take a birds-eye view of all the agile methodologies,
clean-code best practices, conventions, collaboration tools, etc, what you and your organization really
want is to deliver value to the costumer. Ok, makes sense, right?&lt;/p&gt;
&lt;p&gt;It does! And the people from the &lt;em&gt;DevOps Handbook&lt;/em&gt; even came up with this idea of a &lt;code class=&quot;language-text&quot;&gt;value-stream&lt;/code&gt;. Now, what is a value stream is in the first place?&lt;/p&gt;
&lt;p&gt;Quoting from the book:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In the DevOps, we typically define a value stream as the process required to &lt;strong&gt;convert a business hypothesis&lt;/strong&gt; into a &lt;strong&gt;technology-enabled service&lt;/strong&gt; that delivers &lt;strong&gt;value&lt;/strong&gt; to the &lt;strong&gt;customer&lt;/strong&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://dev-to-uploads.s3.amazonaws.com/i/zlf5jsfw0qu2hv513xa7.png&quot; alt=&quot;Value Stream&quot;&gt;&lt;/p&gt;
&lt;h1&gt;The Three Ways&lt;/h1&gt;
&lt;p&gt;Right off the bat, the authors split DevOps practices into three ways:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;The First Way&lt;/strong&gt; enables fast left-to-right flow of work from Development to Operations to the customer. In order to maximize flow, we need to make work visible, reduce our batch sizes and intervals of work, build in quality by preventing defects from being passed to downstream work centers, and constantly optimize for the global goals.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;The Second Way&lt;/strong&gt; enables the fast and constant flow of feedback from right to left at all stages of our value stream. It requires that we amplify feedback to prevent problems from happening again, or enable faster detection and recovery.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;The Third Way&lt;/strong&gt; enables the creation of a generative, high-trust culture that supports a dynamic, disciplined, and scientific approach to experimentation and risk-taking, facilitating the creation of organizational learning, both from our successes and failures. Furthermore, by continually shortening and amplifying our feedback loops, we create ever-safer systems of work and are better able to take risks and perform experiments that help us learn faster than our competition and win in the marketplace.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The book is divided into three parts, one per way. Each part documents the relevant technical practices with supporting case studies and experiences sourced from industry behemoths like Netflix and Amazon.&lt;/p&gt;
&lt;p&gt;But this is not a book review, and for the purpose of this series I wanted to share some insights on topics I’ve found particularly compelling. Let’s dive in!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Type safe scripts]]></title><description><![CDATA[A kotlin script is a way to compile and run  code easily.
Scripts are a powerful tool when you want to automate any kind of work. The most…]]></description><link>https://iurysza.github.com/thoughtbox/kotlin-scripting/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/kotlin-scripting/</guid><pubDate>Sun, 26 Jul 2020 10:00:00 GMT</pubDate><content:encoded>&lt;p&gt;A kotlin script is a way to &lt;strong&gt;compile&lt;/strong&gt; and &lt;strong&gt;run&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;Kotlin&lt;/code&gt; code easily.
Scripts are a powerful tool when you want to automate any kind of work. The most used languages for scripting tend to be &lt;code class=&quot;language-text&quot;&gt;python&lt;/code&gt;
or &lt;code class=&quot;language-text&quot;&gt;bash&lt;/code&gt;/&lt;code class=&quot;language-text&quot;&gt;shell&lt;/code&gt; but, what if you could get the same task done with &lt;code class=&quot;language-text&quot;&gt;Kotlin&lt;/code&gt;?
But not just that. What if you had access to any java or kotlin library in your scripts?&lt;/p&gt;
&lt;p&gt;With &lt;code class=&quot;language-text&quot;&gt;Kscript&lt;/code&gt; you can easily do that! Besides it also offers a lot of features.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Scripts caching: Running the same script will be way faster the second time.&lt;/li&gt;
&lt;li&gt;Maven dependencies&lt;/li&gt;
&lt;li&gt;IntelliJ support&lt;/li&gt;
&lt;li&gt;Bootstrap header&lt;/li&gt;
&lt;li&gt;Check the &lt;a href=&quot;https://github.com/holgerbrandl/kscript&quot;&gt;kscript repo&lt;/a&gt; for the full feature set.&lt;/li&gt;
&lt;/ul&gt;
&lt;br&gt;
&lt;h3&gt;Trying it out&lt;/h3&gt;
&lt;p&gt;Install it with &lt;a href=&quot;https://sdkman.io&quot;&gt;sdk man&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ sdk &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; kscript&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;/p&gt;
Now let&apos;s create a `.kts` file and try importing some libraries to create an embedded server:
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;#&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;usr&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;bin&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;env kscript

&lt;span class=&quot;token annotation builtin&quot;&gt;@file:MavenRepository&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;bintray-ktor&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;https://dl.bintray.com/kotlin/ktor&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token annotation builtin&quot;&gt;@file:DependsOnMaven&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;io.ktor:ktor-server-netty:1.2.6&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ktor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ktor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;http&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ktor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ktor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;routing&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ktor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;engine&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ktor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;netty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;starting server...&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; server &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;embeddedServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Netty&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; port &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  routing &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      call&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;respondText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World!&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ContentType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Text&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Plain&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;wait &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, lets run it!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ kscript kscript-server.kts&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Open your browser on &lt;code class=&quot;language-text&quot;&gt;localhost:8080/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Cool, right?&lt;/p&gt;
&lt;p&gt;But if you’re like me you probably do most of your work on the IDE. So, let’s try that now.&lt;/p&gt;
&lt;p&gt;If you have Intelij Idea on your machine you can type&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ kscript --idea kscript-server.kts &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and it will generate a Gradle Kotlin project with all dependencies declared with the &lt;code class=&quot;language-text&quot;&gt;@file&lt;/code&gt; convention and add them to a Gradle file.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;#Protip&lt;/strong&gt;: If syntax highlighting is not working properly, just right click on the &lt;code class=&quot;language-text&quot;&gt;build.gradle&lt;/code&gt; file select &lt;code class=&quot;language-text&quot;&gt;Import Gradle project&lt;/code&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[A Twitter-Telegram bot in Kotlin]]></title><description><![CDATA[Have you ever wondered how Twitter bots work?
Can we integrate them with Telegram?
Is it possible to do this only with Kotlin? Fret not…]]></description><link>https://iurysza.github.com/thoughtbox/writing_a_twitter_bot_with_kotlin/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/writing_a_twitter_bot_with_kotlin/</guid><pubDate>Thu, 09 Jul 2020 11:53:37 GMT</pubDate><content:encoded>&lt;p&gt;Have you ever wondered how &lt;strong&gt;Twitter bots&lt;/strong&gt; work?
Can we integrate them with &lt;strong&gt;Telegram&lt;/strong&gt;?
Is it possible to do this &lt;strong&gt;only&lt;/strong&gt; with &lt;strong&gt;Kotlin&lt;/strong&gt;?&lt;/p&gt;
&lt;p&gt;Fret not! Follow me while we uncover these mysteries!&lt;/p&gt;
&lt;h3&gt;What we’ll be creating&lt;/h3&gt;
&lt;p&gt;The idea here is pretty straight forward:
A Twitter bot that downloads videos from tweets and sends them to me on Telegram.&lt;/p&gt;
&lt;p&gt;Whenever I reply to a post on Twitter that has a video, tagging the bot’s username, the bot will download the video and send it to me on telegram.
Simple enough, right?  You might have even seen something similar in the wild.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://i.imgur.com/ov4jueb.png&quot; alt=&quot;Example of a similar bot in the wild&quot; title=&quot;@BaixaEssaPorra is a popular downloader bot in the brazilian twittersphere&quot;&gt;&lt;/p&gt;
&lt;h3&gt;Getting a little more technical&lt;/h3&gt;
&lt;p&gt;Now that we know what we want, how can we achieve this?&lt;/p&gt;
&lt;p&gt;We’ll have an application running locally on our machines that will somehow &lt;strong&gt;listen to tweets that mention another user&lt;/strong&gt;.
After being notified of this event, we will need to &lt;strong&gt;fetch the video URL&lt;/strong&gt; from the tweet we’re replying to, &lt;strong&gt;download the video&lt;/strong&gt; and finally &lt;strong&gt;send it over to a telegram user&lt;/strong&gt; using the a bot.&lt;/p&gt;
&lt;p&gt;After reading the &lt;a href=&quot;https://developer.twitter.com/en/docs&quot;&gt;Twitter developer docs&lt;/a&gt; I’ve found they offer 3 possibilities:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.twitter.com/en/docs/tweets/timelines/api-reference/get-statuses-mentions_timeline&quot;&gt;HTTP Polling&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.twitter.com/en/docs/tutorials/consuming-streaming-data#consuming-the-stream&quot;&gt;HTTP Streaming&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.twitter.com/en/docs/accounts-and-users/subscribe-account-activity/overview&quot;&gt;WebHooks&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(If you’re not familiar with these concepts you can check this &lt;a href=&quot;https://medium.com/@jeff.lee6268/getting-started-with-realtime-b5a8773deb1a&quot;&gt;article&lt;/a&gt; to understand the basics.)&lt;/p&gt;
&lt;h3&gt;Choosing our tools&lt;/h3&gt;
&lt;p&gt;Now, since we’re planning to use Kotlin to develop this, the first thing I did before diving-in was a little research (as usual). It seems we have some library options to make this task a little smoother.&lt;/p&gt;
&lt;p&gt;Here’s what I found:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There’s an unofficial Java library for the Twitter API called &lt;a href=&quot;http://twitter4j.org/en/&quot;&gt;Twitter4j&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;There’s a Java HTTP client for consuming Twitter’s realtime streaming API called  &lt;a href=&quot;https://github.com/twitter/hbc&quot;&gt;HBC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;There’s a wrapper for the Telegram bot API written in Kotlin called &lt;a href=&quot;https://github.com/kotlin-telegram-bot/kotlin-telegram-bot&quot;&gt;kotlin-telegram-bot&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Sweet! The job just got a whole lot easier now that we don’t need to build the HTTP clients for any of these.&lt;/p&gt;
&lt;p&gt;The only issue is that we don’t have any java/kotlin library to work with the &lt;code class=&quot;language-text&quot;&gt;WebHooks&lt;/code&gt; api, so we’ll be using the ones above.&lt;/p&gt;
&lt;h3&gt;Let’s code!&lt;/h3&gt;
&lt;p&gt;First of all we need to get the keys to play with these services.&lt;/p&gt;
&lt;p&gt;To get Twitter keys we’ll need to create a Twitter App, you can get yours &lt;a href=&quot;https://developer.twitter.com/en/account/get-started&quot;&gt;here&lt;/a&gt;
To get &lt;code class=&quot;language-text&quot;&gt;Telegram&lt;/code&gt;’s token is just as simple as talking to the &lt;a href=&quot;https://web.telegram.org/#/im?p=@BotFather&quot;&gt;BotFather&lt;/a&gt;&lt;/p&gt;
&lt;h4&gt;Hiding keys, tokens and secrets&lt;/h4&gt;
&lt;p&gt;First, we need a mechanism to load keys, secrets, userIds and tokens used in the project. It is a good practice to keep our keys out of version control.&lt;/p&gt;
&lt;p&gt;To do that, we create a json file with all the keys and put it in the &lt;code class=&quot;language-text&quot;&gt;resources&lt;/code&gt; folder.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;consumerKey&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;abc1234DEF1234GHI456&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;consumerSecret&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;abc1234DEF1234GHI456abc1234DEF1234GHI456&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;token&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0123456789-abc1234DEF1234GHI456&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;tokenSecret&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;abc1234DEF1234GHI456abc1234DEF1234GHI456&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;telegramToken&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0123456789:abc1234DEF1234GHI456-abc1234DEF1234GHI456&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;twitterUserId&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;012345678901234567890123456789&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;telegramUserId&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;01234567890123456789&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, we can use &lt;a href=&quot;https://github.com/square/moshi&quot;&gt;Moshi&lt;/a&gt; to simplify deserialization and the &lt;code class=&quot;language-text&quot;&gt;AuthLoader&lt;/code&gt; class to wrap it up.&lt;/p&gt;
&lt;p&gt;Add this to your &lt;code class=&quot;language-text&quot;&gt;gradle&lt;/code&gt; file&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token function&quot;&gt;implementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.squareup.moshi:moshi:1.9.3&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;implementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.squareup.moshi:moshi-kotlin:1.9.3&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;kapt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.squareup.moshi:moshi-kotlin-codegen:1.9.3&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; MoshiWrapper &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; instance&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Moshi &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Moshi&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Builder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;KotlinJsonAdapterFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;inline&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;reified&lt;/span&gt; T &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Any&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fromJson&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; KClass&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; json&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; T&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;adapter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;java&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fromJson&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;json&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@JsonClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;generateAdapter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;AuthData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; consumerKey&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; consumerSecret&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; token&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; tokenSecret&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; telegramToken&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; twitterUserId&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; telegramUserId&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; AuthLoader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;toOAuth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AuthData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; OAuth1 &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;consumerKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; consumerSecret&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; token&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tokenSecret&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; authData
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;OAuth1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;consumerKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; consumerSecret&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; token&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tokenSecret&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getAuthDataFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fileName&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AuthData &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; fileContent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getFileFromResources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;fileName&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; MoshiWrapper&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fromJson&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            AuthData&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            fileContent
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!!&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getFileFromResources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fileName&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; resource &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getResource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fileName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resource &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;file not found!&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resource&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;readText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Filtering real time tweets&lt;/h4&gt;
&lt;p&gt;The &lt;a href=&quot;https://developer.twitter.com/en/docs/tweets/filter-realtime/api-reference/post-statuses-filter&quot;&gt;docs&lt;/a&gt; tell us that we can filter tweets using some parameters like &lt;code class=&quot;language-text&quot;&gt;keywords&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;userIds&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;In order to do that we can use the &lt;code class=&quot;language-text&quot;&gt;HBC-core&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;HBC-Twitter4j&lt;/code&gt; integration.&lt;/p&gt;
&lt;p&gt;So, we’ll be using a &lt;code class=&quot;language-text&quot;&gt;Twitter4jStatusClient&lt;/code&gt; to listen to filtered status updates. This class is a wrapper of HBC’s  &lt;code class=&quot;language-text&quot;&gt;BasicClient&lt;/code&gt; . It is  responsible for opening the connection with the Streaming API and to pass filter parameters. The Integration with &lt;code class=&quot;language-text&quot;&gt;Twitter4j&lt;/code&gt; removes the need to model and deserialize the json responses when receiving status updates.&lt;/p&gt;
&lt;p&gt;First we add the dependencies&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token function&quot;&gt;implementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.twitter:hbc-core:2.2.0&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;implementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.twitter:hbc-twitter4j:2.2.0&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;implementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;org.twitter4j:twitter4j-core:4.0.7&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;implementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;org.slf4j:slf4j-log4j12:1.6.0&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//needed for twitter4j&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;implementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;io.github.kotlin-telegram-bot.kotlin-telegram-bot:telegram:5.0.0&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is the implementation I came up to simplify consuming this stream:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;FilteredStatusStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; authData&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AuthData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; filterParams&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; FilterParams&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; statusListener&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Status&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; Unit
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;companion&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; CAPACITY &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1_000&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; THREAD_POOL_SIZE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; statusClient&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Twitter4jStatusClient&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;followings&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; keywords&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; filterParams

        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; filters &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createStatusFilters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;followings&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; keywords&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; msgQueue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; LinkedBlockingQueue&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; CAPACITY&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createBasicClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;filters&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; msgQueue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CAPACITY&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        statusClient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createStatusClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; msgQueue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; THREAD_POOL_SIZE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        statusClient&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createStatusFilters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;followings&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Long&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; terms&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;StatusesFilterEndpoint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;followings&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;followings&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;trackTerms&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;terms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createStatusClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        client&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; BasicClient&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        msgQueue&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; LinkedBlockingQueue&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        poolSize&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Int
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Twitter4jStatusClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        msgQueue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;DefaultStatusListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;statusListener&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        Executors&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newFixedThreadPool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;poolSize&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createBasicClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        endpoint&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; StatusesFilterEndpoint&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        msgQueue&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; LinkedBlockingQueue&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        eventQueueSize&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Int
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ClientBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;HttpHosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Constants&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;STREAM_HOST&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;authentication&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AuthLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toOAuth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;endpoint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;endpoint&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;processor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;StringDelimitedProcessor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msgQueue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;eventMessageQueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;LinkedBlockingQueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;eventQueueSize&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It looks like a lot, but it is really just configuration code. We’re just hiding the complexity of setting up a Twitter steaming client.
Now we can listen to the tweets from the user with the &lt;code class=&quot;language-text&quot;&gt;twitterUserId&lt;/code&gt; whenever he mentions the tweeter handle &lt;code class=&quot;language-text&quot;&gt;@MandaProZap&lt;/code&gt; just by calling:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; authData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; AuthLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAuthDataFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;auth_data.json&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; filterParams &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;FilterParams&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;twitterUserId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;@MandaProZap&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    
&lt;span class=&quot;token function&quot;&gt;FilteredStatusStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; filterParams&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; newStatus &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newStatus&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Awesome, right?!😁&lt;/p&gt;
&lt;p&gt;But… how do we get the video data?
First of all, just a quick recap: We want to get the video from the &lt;strong&gt;tweet&lt;/strong&gt; that we’re &lt;strong&gt;replying&lt;/strong&gt; to.&lt;/p&gt;
&lt;p&gt;This &lt;code class=&quot;language-text&quot;&gt;newStatus&lt;/code&gt; we’re getting from the stream is our &lt;strong&gt;own tweet&lt;/strong&gt;. So we still need to get the parent tweet and it’s video.&lt;/p&gt;
&lt;h4&gt;Getting media from the parent tweet&lt;/h4&gt;
&lt;p&gt;Inspecting the &lt;code class=&quot;language-text&quot;&gt;Status&lt;/code&gt; returned from the stream we can see it’s properties:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Date&lt;/span&gt; createdAt&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; text&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; displayTextRangeStart &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; displayTextRangeEnd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; source&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; isTruncated&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; inReplyToStatusId&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//This is the one we need&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we can use &lt;code class=&quot;language-text&quot;&gt;Twitter4j&lt;/code&gt; to fetch the parent tweet.&lt;/p&gt;
&lt;p&gt;Again, we can simplify it’s usage with this class:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TwitterClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; AuthData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; twitter&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Twitter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TwitterFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;instance

    &lt;span class=&quot;token keyword&quot;&gt;init&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        twitter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setOAuthConsumer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;consumerKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;consumerSecret&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; accessToken &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;AccessToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;token&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tokenSecret&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        twitter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;oAuthAccessToken &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; accessToken
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getStatusById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;statusId&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Status&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; runCatching &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; twitter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;showStatus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;statusId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getOrNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally we can get the video url like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; twitterClient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TwitterClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
twitterClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getStatusById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newStatus&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;inReplyToStatusId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mediaEntities
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mapNotNull&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;videoVariants&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;firstOrNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;url &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; url &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Almost there now! We just need to send the video to Telegram! But wait… if we send this url… we’ll be sending just an url… not an actual video. We can do better!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Downloading the video&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Since we’re using the &lt;code class=&quot;language-text&quot;&gt;kotlin-telegram-bot&lt;/code&gt;, and it has transitive dependencies to &lt;a href=&quot;https://github.com/square/retrofit&quot;&gt;retrofit&lt;/a&gt; it seems like a good idea to using it to download the video file.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; FileDownloader &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; service &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Retrofit
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Builder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;baseUrl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http://localhost/&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;FileDownloadService&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;java&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;suspend&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;downloadAndWriteToFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; File&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;withContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Dispatchers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;IO&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; body &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; service&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;downloadFileFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;writeToFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;writeToFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;responseBody&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; ResponseBody&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; File&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; runCatching &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;currentTimeMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.mp4&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;createNewFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            Okio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Okio&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sink&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;responseBody&lt;span class=&quot;token operator&quot;&gt;!!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bytes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getOrNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; FileDownloadService &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation builtin&quot;&gt;@GET&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;downloadFileFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Url&lt;/span&gt; fileUrl&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Call&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ResponseBody&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we’re creating a  &lt;code class=&quot;language-text&quot;&gt;FileDownloadService&lt;/code&gt; with &lt;code class=&quot;language-text&quot;&gt;Retrofit&lt;/code&gt; and use it to download the url.&lt;/p&gt;
&lt;p&gt;After that we write the data to a file using &lt;code class=&quot;language-text&quot;&gt;Okio&lt;/code&gt; (also comes bundled with retrofit).&lt;/p&gt;
&lt;p&gt;You can see that we’re using coroutines to switch threads while it still looks like synchronous code.&lt;/p&gt;
&lt;p&gt;This was achieved with a simple extension function on &lt;code class=&quot;language-text&quot;&gt;retrofit&lt;/code&gt;’s  &lt;code class=&quot;language-text&quot;&gt;Call&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;suspend&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Call&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; T &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; suspendCancellableCoroutine &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; continuation &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;enqueue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Callback&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;call&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Call&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; response&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Response&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;isSuccessful &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    continuation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resumeWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;success&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    continuation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resumeWithException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

            &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onFailure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;call&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Call&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; t&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Throwable&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                continuation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resumeWithException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ok, now we’re downloading the video file. We just need to send it over to Telegram!&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Sending the video to Telegram&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This is the easiest part thanks to the amazing &lt;code class=&quot;language-text&quot;&gt;kotlin-telegram-bot&lt;/code&gt; library.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; telegramBot &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bot &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; token &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;telegramToken &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
telegramBot&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendVideo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;telegramUserId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; videoFile&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Putting it all together&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; authData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; AuthLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAuthDataFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;auth_data.json&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; filterParams &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;FilterParams&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;twitterUserId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;@MandaProZap&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; twitterClient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TwitterClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; telegramBot &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bot &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; token &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;telegramToken &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;FilteredStatusStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; filterParams&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; newStatus &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        twitterClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getStatusById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newStatus&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;inReplyToStatusId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mediaEntities
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mapNotNull&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;videoVariants&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;firstOrNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;url &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; url &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
                GlobalScope&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;launch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    FileDownloader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;downloadAndWriteToFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; videoFile &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
                        telegramBot&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendVideo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;telegramUserId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; videoFile&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; authData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; AuthLoader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAuthDataFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;auth_data.json&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; filterParams &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;FilterParams&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;twitterUserId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;@MandaProZap&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; twitterClient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TwitterClient&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; telegramBot &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bot &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; token &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;telegramToken &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;FilteredStatusStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; filterParams&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; newStatus &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
        twitterClient&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getStatusById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newStatus&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;inReplyToStatusId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mediaEntities
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mapNotNull&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;videoVariants&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;firstOrNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;url &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; url &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
                GlobalScope&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;launch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    FileDownloader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;downloadAndWriteToFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; videoFile &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
                        telegramBot&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendVideo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;authData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;telegramUserId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; videoFile&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Summing it all up!&lt;/h3&gt;
&lt;p&gt;Yes, we can create a twitter-telegram bot with Kotlin while keeping it fairly simple.&lt;/p&gt;
&lt;p&gt;Taking advantage of these libraries make the experience a lot smoother and adding some wrappers on top of it helps to hide the complexity and enable us to create a declarative API to let us focus on what matters.&lt;/p&gt;
&lt;p&gt;The next step here is to implement this idea using the &lt;code class=&quot;language-text&quot;&gt;WebHook API&lt;/code&gt;, but this will have to be in a another post.&lt;/p&gt;
&lt;p&gt;I hope you learned something along the way, I certainly did!&lt;/p&gt;
&lt;p&gt;You can check the project on &lt;a href=&quot;https://github.com/iurysza/twitter-telegram-bot&quot;&gt;github&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Setting up MockServer]]></title><description><![CDATA[Main goals: Simple and declarative testing environment setup. Runs everywhere Strategy Set up a replicable local server. Docker…]]></description><link>https://iurysza.github.com/thoughtbox/setting-up-mockserver/</link><guid isPermaLink="false">https://iurysza.github.com/thoughtbox/setting-up-mockserver/</guid><pubDate>Tue, 21 Apr 2020 07:03:47 GMT</pubDate><content:encoded>&lt;h2&gt;Main goals:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Simple and declarative testing environment setup.&lt;/li&gt;
&lt;li&gt;Runs everywhere&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Strategy&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Set up a replicable local server.&lt;/p&gt;
&lt;p&gt;Docker - &lt;em&gt;Containerized applications (actually write once, runs anywhere)&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Provide an expectations json where all the requests are mapped out.&lt;/p&gt;
&lt;p&gt;MockServer - Create local server with complex request/response expectations through a json resource or a REST API.&lt;/p&gt;
&lt;img src=&quot;https://miro.medium.com/max/1400/0*LOnXgsR6pNv7mHvu.png&quot; alt=&quot;MockServer&quot; style=&quot;zoom:33%;&quot;&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Making it happen&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/get-docker/&quot;&gt;Install Docker&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install &lt;a href=&quot;https://docs.docker.com/compose/install/&quot;&gt;Docker Compose&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Make sure your docker daemon is up and running.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Create a folder for your MockServer setup.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; /path/to/mockserver_container/ &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; /path/to/mockserver_container&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Create the &lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt; .&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This is where you’ll setup your container for MockServer.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; ./docker-compose.yml &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;nano&lt;/span&gt; ./docker-compose.yml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Paste this code snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;version: “2.4”
services:
mockServer:
image: mockserver/mockserver:latest
ports:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;1080:1080
environment:
MOCKSERVER_PROPERTY_FILE: /config/mockserver.properties
MOCKSERVER_INITIALIZATION_JSON_PATH: /config/initializerJson.json
volumes:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;type: bind
source: .
target: /config&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;
This is saying:

- Create a service named `mockserver` using the docker image from `mockserver/mockserver:latest`.

- Assign the `host port` 1080 to the `container port` 1080.
- Set the `enviroment variables` to the provided paths.
  
- Create a `volume` binding from the `current directory` (this file&apos;s dir) to `/config` inside the container.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Setup the Expectation Initializer JSON.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Create the &lt;code class=&quot;language-text&quot;&gt;initializerJson&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; ./initializerJson.json &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;nano&lt;/span&gt; ./initializerJson.json&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Paste this code snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;httpRequest&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;method&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;GET&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/api/v1/weather&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;queryStringParameters&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;code&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;10969&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;httpResponse&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;body&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{\&quot;wheather\&quot;: 20.5}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;statusCode&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Full documentation reference can be found &lt;a href=&quot;https://app.swaggerhub.com/apis/jamesdbloom/mock-server-openapi/5.9.x#/Expectation&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Running your container&lt;/h2&gt;
&lt;p&gt;Now that we’ve got the plumbing out of the way, it’s time to run it.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Before running your container check if have any other containers in your environment:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ps&lt;/span&gt; -a&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This should print an empty table.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Build your container:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Inside the folder you created the &lt;code class=&quot;language-text&quot;&gt;.yml&lt;/code&gt; type:&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;docker-compose&lt;/span&gt; up&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Your terminal should print something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;Creating mockserver_mockServer_1 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;. &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;
Attaching to mockserver_mockServer_1
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; 
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; java  -Dfile.encoding&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;UTF-8 -jar /opt/mockserver/mockserver-netty-jar-with-dependencies.jar  -server
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; 
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2020&lt;/span&gt;-04-11 &lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt;:52:30  org.mockserver.log.MockServerEventLog  INFO  creating expectation:
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; 
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;token string&quot;&gt;&quot;id&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;3f3962d2-9c03-4dce-95cd-2522962ceccb&quot;&lt;/span&gt;,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;token string&quot;&gt;&quot;priority&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;token string&quot;&gt;&quot;httpRequest&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;       &lt;span class=&quot;token string&quot;&gt;&quot;method&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;GET&quot;&lt;/span&gt;,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;       &lt;span class=&quot;token string&quot;&gt;&quot;path&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/api/v1/weather&quot;&lt;/span&gt;,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;       &lt;span class=&quot;token string&quot;&gt;&quot;queryStringParameters&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;         &lt;span class=&quot;token string&quot;&gt;&quot;code&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;10969&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;       &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;token string&quot;&gt;&quot;times&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;       &lt;span class=&quot;token string&quot;&gt;&quot;unlimited&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;token string&quot;&gt;&quot;timeToLive&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;       &lt;span class=&quot;token string&quot;&gt;&quot;unlimited&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;token string&quot;&gt;&quot;httpResponse&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;       &lt;span class=&quot;token string&quot;&gt;&quot;statusCode&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;       &lt;span class=&quot;token string&quot;&gt;&quot;body&quot;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{&lt;span class=&quot;token entity&quot; title=&quot;\&amp;quot;&quot;&gt;\&quot;&lt;/span&gt;wheather&lt;span class=&quot;token entity&quot; title=&quot;\&amp;quot;&quot;&gt;\&quot;&lt;/span&gt;: 20.5}&quot;&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;     &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;  
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2020&lt;/span&gt;-04-11 &lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt;:52:30  org.mockserver.cli.Main  INFO  logger level is INFO, change using:
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;  - &lt;span class=&quot;token string&quot;&gt;&apos;ConfigurationProperties.logLevel(String level)&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; Java code,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;  - &lt;span class=&quot;token string&quot;&gt;&apos;-logLevel&apos;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;command&lt;/span&gt; line argument,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;  - &lt;span class=&quot;token string&quot;&gt;&apos;mockserver.logLevel&apos;&lt;/span&gt; JVM system property or,
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;  - &lt;span class=&quot;token string&quot;&gt;&apos;mockserver.logLevel&apos;&lt;/span&gt; property value &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;mockserver.properties&apos;&lt;/span&gt; 
mockServer_1  &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2020&lt;/span&gt;-04-11 &lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt;:52:30  org.mockserver.log.MockServerEventLog  INFO  started on port: &lt;span class=&quot;token number&quot;&gt;1080&lt;/span&gt; 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Sending requests&lt;/h2&gt;
&lt;p&gt;Open a new terminal window and enter:&lt;/p&gt;
&lt;p&gt;To see info about your available containers enter again:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;docker&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ps&lt;/span&gt; -a&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can now see some info about your running container.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; localhost:1080/api/v1/weather&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;?code&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10969&lt;/span&gt;           &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see the response:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{&quot;wheather&quot;: 20.5}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And thats it!&lt;/p&gt;
&lt;p&gt;You’ve got yourself a local server where you can mock simple and complex requests and responses.&lt;/p&gt;
&lt;h3&gt;Useful links:&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://app.swaggerhub.com/apis/jamesdbloom/mock-server-openapi/5.9.x&quot;&gt;REST API Swagger docs&lt;/a&gt;&lt;/p&gt;</content:encoded></item></channel></rss>